<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My PD History - WCED Professional Development</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'wcg-green': '#76B82A',
                        'wcg-yellow': '#FDB913',
                        'wcg-red': '#E30613',
                        'wcg-blue': '#007BC0',
                        'wcg-purple': '#672D82',
                        'wcg-pink': '#C8126E',
                        'wcg-dark': '#1a1a1a',
                        'wcg-gray': '#666666'
                    },
                    fontFamily: {
                        'sans': ['Arial', 'Helvetica', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background: white !important;
            }
            .print-full-width {
                max-width: 100% !important;
            }
        }
        
        .spark-overlay {
            background: linear-gradient(135deg, rgba(253, 185, 19, 0.05) 0%, rgba(253, 185, 19, 0.1) 100%);
        }
        
        .dovetail-overlay {
            background: linear-gradient(135deg, rgba(200, 18, 110, 0.05) 0%, rgba(200, 18, 110, 0.1) 100%);
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Sparks sessions
        const SPARK_SESSIONS = [
            'Adoption Strategy',
            'Digital Skills Course',
            'Facilitator Think Tank',
            'Cyber Effect Ambassador Initiation Course'
        ];

        // Dovetail Essentials sessions
        const DOVETAIL_SESSIONS = [
            'ePedagogy: Building a Digital Lesson',
            'Integrating digital resources from the ePortal',
            'Google Fundamentals 1: Account and Google Chrome',
            'Office Online Fundamentals',
            'Improved Presentation Skills',
            'Ease of Access with QR Codes and Bit.ly links',
            'Teaching with Videos',
            'Orientation to Google Forms',
            'AI In Education: Work Smarter, not Harder',
            'Introduction to Cyber Wellness Education'
        ];

        // Utility: Parse DD/MM/YYYY HH:MM:SS format
        function parseTimestamp(timestamp) {
            if (!timestamp) return null;
            try {
                const [datePart] = timestamp.split(' ');
                const [day, month, year] = datePart.split('/');
                return new Date(year, month - 1, day);
            } catch {
                return null;
            }
        }

        // Utility: Format date for display
        function formatDate(dateObj) {
            if (!dateObj) return 'N/A';
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const year = dateObj.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Utility: Get development level color
        function getLevelColor(level) {
            if (!level) return 'bg-gray-200 text-gray-800';
            const normalized = level.toLowerCase().trim();
            if (normalized === 'laying the foundation') return 'bg-wcg-green text-white';
            if (normalized === 'i can do it') return 'bg-wcg-yellow text-black';
            if (normalized === 'i can do it better') return 'bg-wcg-red text-white';
            if (normalized === 'the summit') return 'bg-wcg-blue text-white';
            return 'bg-gray-200 text-gray-800';
        }

        // Utility: Check if session is a Spark
        function isSpark(sessionName) {
            return SPARK_SESSIONS.includes(sessionName?.trim());
        }

        // Utility: Check if session is Dovetail Essential
        function isDovetail(sessionName) {
            return DOVETAIL_SESSIONS.includes(sessionName?.trim());
        }

        // Checklist Modal Component
        function ChecklistModal({ isOpen, onClose, type, completedSessions, allSessions }) {
            if (!isOpen) return null;

            const title = type === 'spark' ? '‚≠ê Spark Sessions' : 'üíé Dovetail Essentials';
            
            // For Sparks, check if they have bonus spark
            const uniqueDovetails = type === 'spark' 
                ? [...new Set(allSessions.filter(s => isDovetail(s['Session Name']?.trim())).map(s => s['Session Name']?.trim()))]
                : [];
            const bonus5Dovetail = type === 'spark' && uniqueDovetails.length >= 5;

            const sessionsList = type === 'spark' ? SPARK_SESSIONS : DOVETAIL_SESSIONS;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop no-print" onClick={onClose}>
                    <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden" onClick={e => e.stopPropagation()}>
                        <div className="p-6 border-b border-gray-200">
                            <div className="flex justify-between items-center">
                                <h3 className="text-2xl font-bold text-wcg-dark">{title}</h3>
                                <button 
                                    onClick={onClose}
                                    className="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                                >
                                    √ó
                                </button>
                            </div>
                        </div>
                        <div className="p-6 overflow-y-auto max-h-[60vh]">
                            <div className="space-y-3">
                                {sessionsList.map((session, idx) => {
                                    const isCompleted = completedSessions.includes(session);
                                    return (
                                        <div 
                                            key={idx}
                                            className={`flex items-start gap-3 p-3 rounded-lg border-2 ${
                                                isCompleted 
                                                    ? 'border-green-500 bg-green-50' 
                                                    : 'border-gray-300 bg-gray-50'
                                            }`}
                                        >
                                            <div className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center ${
                                                isCompleted ? 'bg-green-500' : 'bg-gray-300'
                                            }`}>
                                                {isCompleted && (
                                                    <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                    </svg>
                                                )}
                                            </div>
                                            <span className={`flex-1 ${isCompleted ? 'text-green-900 font-medium' : 'text-gray-500'}`}>
                                                {session}
                                            </span>
                                        </div>
                                    );
                                })}
                                
                                {type === 'spark' && (
                                    <div 
                                        className={`flex items-start gap-3 p-3 rounded-lg border-2 mt-4 ${
                                            bonus5Dovetail
                                                ? 'border-green-500 bg-green-50' 
                                                : 'border-gray-300 bg-gray-50'
                                        }`}
                                    >
                                        <div className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center ${
                                            bonus5Dovetail ? 'bg-green-500' : 'bg-gray-300'
                                        }`}>
                                            {bonus5Dovetail && (
                                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                                </svg>
                                            )}
                                        </div>
                                        <span className={`flex-1 ${bonus5Dovetail ? 'text-green-900 font-medium' : 'text-gray-500'}`}>
                                            <strong>Bonus Spark:</strong> Complete 5+ Dovetail Essentials ({uniqueDovetails.length}/5)
                                        </span>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchType, setSearchType] = useState('id');
            const [searchValue, setSearchValue] = useState('');
            const [acknowledged, setAcknowledged] = useState(false);
            const [results, setResults] = useState(null);
            const [viewMode, setViewMode] = useState('cards');
            const [filters, setFilters] = useState({
                level: '',
                district: '',
                mode: '',
                category: ''
            });
            const [modalOpen, setModalOpen] = useState({ isOpen: false, type: null });

            // Load CSV on mount
            useEffect(() => {
                Papa.parse('attendance.csv', {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (result) => {
                        setData(result.data);
                        setLoading(false);
                    },
                    error: (error) => {
                        console.error('Error loading CSV:', error);
                        setLoading(false);
                    }
                });
            }, []);

            // Build indexes for fast lookup
            const indexes = useMemo(() => {
                const idIndex = {};
                const persalIndex = {};

                data.forEach(record => {
                    const id = record['ID/Passport Number']?.trim();
                    const persal = record['PERSAL Number']?.trim();

                    if (id) {
                        if (!idIndex[id]) idIndex[id] = [];
                        idIndex[id].push(record);
                    }
                    if (persal) {
                        if (!persalIndex[persal]) persalIndex[persal] = [];
                        persalIndex[persal].push(record);
                    }
                });

                return { idIndex, persalIndex };
            }, [data]);

            // Handle search
            const handleSearch = () => {
                if (!searchValue.trim() || !acknowledged) return;

                const searchKey = searchValue.trim();
                let records = [];

                if (searchType === 'id') {
                    records = indexes.idIndex[searchKey] || [];
                } else {
                    records = indexes.persalIndex[searchKey] || [];
                }

                if (records.length === 0) {
                    setResults({ profile: null, sessions: [], allSessions: [] });
                    return;
                }

                // Sort by timestamp (newest first)
                const sortedRecords = [...records].sort((a, b) => {
                    const dateA = parseTimestamp(a.Timestamp);
                    const dateB = parseTimestamp(b.Timestamp);
                    return dateB - dateA;
                });

                // Get profile from most recent record
                const mostRecent = sortedRecords[0];
                const profile = {
                    name: `${mostRecent['First Name']} ${mostRecent['Surname']}`.trim(),
                    school: mostRecent['School'] || 'N/A',
                    district: mostRecent['District'] || 'N/A'
                };

                // Deduplicate sessions by Session Name + Timestamp
                const seenSessions = new Set();
                const uniqueSessions = sortedRecords
                    .filter(record => {
                        const key = `${record['Session Name']}_${record.Timestamp}`;
                        if (seenSessions.has(key)) return false;
                        seenSessions.add(key);
                        return true;
                    })
                    .map(record => ({
                        ...record,
                        parsedDate: parseTimestamp(record.Timestamp),
                        year: parseTimestamp(record.Timestamp)?.getFullYear() || 'Unknown',
                        isSpark: isSpark(record['Session Name']),
                        isDovetail: isDovetail(record['Session Name'])
                    }));

                setResults({ profile, sessions: uniqueSessions, allSessions: uniqueSessions });
                setFilters({ level: '', district: '', mode: '', category: '' });
            };

            // Apply filters
            const filteredSessions = useMemo(() => {
                if (!results) return [];

                let filtered = results.allSessions;

                if (filters.level) {
                    filtered = filtered.filter(s => 
                        s['Development Level']?.toLowerCase().trim() === filters.level.toLowerCase().trim()
                    );
                }

                if (filters.district) {
                    filtered = filtered.filter(s => 
                        s['Hosting District']?.trim() === filters.district
                    );
                }

                if (filters.mode) {
                    filtered = filtered.filter(s => 
                        s['Delivery Mode']?.trim() === filters.mode
                    );
                }

                if (filters.category === 'spark') {
                    filtered = filtered.filter(s => s.isSpark);
                }

                if (filters.category === 'dovetail') {
                    filtered = filtered.filter(s => s.isDovetail);
                }

                return filtered;
            }, [results, filters]);

            // Group by year
            const sessionsByYear = useMemo(() => {
                const grouped = {};
                filteredSessions.forEach(session => {
                    const year = session.year;
                    if (!grouped[year]) grouped[year] = [];
                    grouped[year].push(session);
                });

                return Object.keys(grouped)
                    .sort((a, b) => b - a)
                    .map(year => ({
                        year,
                        sessions: grouped[year]
                    }));
            }, [filteredSessions]);

            // Calculate metrics
            const metrics = useMemo(() => {
                if (!results) return null;

                const total = filteredSessions.length;
                const byLevel = {
                    'Laying the Foundation': 0,
                    'I can do it': 0,
                    'I can do it better': 0,
                    'The Summit': 0,
                    'Other': 0
                };

                filteredSessions.forEach(session => {
                    const level = session['Development Level']?.trim();
                    if (byLevel.hasOwnProperty(level)) {
                        byLevel[level]++;
                    } else {
                        byLevel['Other']++;
                    }
                });

                // Get unique Spark sessions attended
                const uniqueSparkSessions = [...new Set(
                    results.allSessions
                        .filter(s => s.isSpark)
                        .map(s => s['Session Name']?.trim())
                )];

                // Get unique Dovetail sessions attended
                const uniqueDovetailSessions = [...new Set(
                    results.allSessions
                        .filter(s => s.isDovetail)
                        .map(s => s['Session Name']?.trim())
                )];

                // Calculate total Sparks (including bonus)
                const bonusSpark = uniqueDovetailSessions.length >= 5 ? 1 : 0;
                const totalSparks = uniqueSparkSessions.length + bonusSpark;

                return { 
                    total, 
                    byLevel, 
                    uniqueSparks: uniqueSparkSessions,
                    uniqueDovetails: uniqueDovetailSessions,
                    totalSparks,
                    totalDovetails: uniqueDovetailSessions.length,
                    hasBonusSpark: bonusSpark === 1
                };
            }, [filteredSessions, results]);

            // Get unique filter values
            const filterOptions = useMemo(() => {
                if (!results) return { levels: [], districts: [], modes: [] };

                const levels = [...new Set(results.allSessions.map(s => s['Development Level']?.trim()).filter(Boolean))];
                const districts = [...new Set(results.allSessions.map(s => s['Hosting District']?.trim()).filter(Boolean))].sort();
                const modes = [...new Set(results.allSessions.map(s => s['Delivery Mode']?.trim()).filter(Boolean))].sort();

                return { levels, districts, modes };
            }, [results]);

            // Export to CSV
            const exportToCSV = () => {
                const csvData = filteredSessions.map(session => ({
                    'Date': formatDate(session.parsedDate),
                    'Session Name': session['Session Name'] || '',
                    'Development Level': session['Development Level'] || '',
                    'Hosting District': session['Hosting District'] || '',
                    'Delivery Mode': session['Delivery Mode'] || '',
                    'Facilitator': session['Facilitator'] || '',
                    'Is Spark': session.isSpark ? 'Yes' : 'No',
                    'Is Dovetail': session.isDovetail ? 'Yes' : 'No'
                }));

                const csv = Papa.unparse(csvData);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'my_pd_history.csv';
                link.click();
            };

            // Input validation
            const isValidInput = () => {
                if (!searchValue.trim()) return false;
                if (searchType === 'id') {
                    return /^\d{13}$/.test(searchValue.trim());
                }
                if (searchType === 'persal') {
                    return /^\d{8}$/.test(searchValue.trim());
                }
                return false;
            };

            const canSearch = acknowledged && isValidInput();

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-wcg-blue mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading attendance records...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <img src="header.png" alt="WCED Header" className="h-16 mx-auto" />
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 print-full-width">
                        {!results ? (
                            <div className="max-w-2xl mx-auto">
                                <div className="bg-white rounded-lg shadow-md p-8">
                                    <h1 className="text-3xl font-bold text-wcg-dark mb-6 text-center">
                                        My PD History
                                    </h1>
                                    <p className="text-gray-600 mb-8 text-center">
                                        View your complete professional development attendance record
                                    </p>

                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Search by:
                                        </label>
                                        <div className="flex gap-4">
                                            <button
                                                onClick={() => { setSearchType('id'); setSearchValue(''); }}
                                                className={`flex-1 py-3 px-4 rounded-lg border-2 transition-colors ${
                                                    searchType === 'id'
                                                        ? 'border-wcg-blue bg-wcg-blue text-white'
                                                        : 'border-gray-300 bg-white text-gray-700 hover:border-wcg-blue'
                                                }`}
                                            >
                                                ID Number
                                            </button>
                                            <button
                                                onClick={() => { setSearchType('persal'); setSearchValue(''); }}
                                                className={`flex-1 py-3 px-4 rounded-lg border-2 transition-colors ${
                                                    searchType === 'persal'
                                                        ? 'border-wcg-blue bg-wcg-blue text-white'
                                                        : 'border-gray-300 bg-white text-gray-700 hover:border-wcg-blue'
                                                }`}
                                            >
                                                PERSAL Number
                                            </button>
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            {searchType === 'id' ? 'ID Number (13 digits)' : 'PERSAL Number (8 digits)'}
                                        </label>
                                        <input
                                            type="text"
                                            value={searchValue}
                                            onChange={(e) => setSearchValue(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && canSearch && handleSearch()}
                                            placeholder={searchType === 'id' ? '1234567890123' : '12345678'}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue focus:border-transparent"
                                            maxLength={searchType === 'id' ? 13 : 8}
                                        />
                                        {searchValue && !isValidInput() && (
                                            <p className="text-sm text-red-600 mt-1">
                                                Please enter a valid {searchType === 'id' ? '13-digit ID' : '8-digit PERSAL'} number
                                            </p>
                                        )}
                                    </div>

                                    <div className="mb-6">
                                        <label className="flex items-start gap-3 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={acknowledged}
                                                onChange={(e) => setAcknowledged(e.target.checked)}
                                                className="mt-1 h-5 w-5 text-wcg-blue border-gray-300 rounded focus:ring-wcg-blue"
                                            />
                                            <span className="text-sm text-gray-700">
                                                I confirm I am accessing my own professional development records for personal verification purposes only.
                                            </span>
                                        </label>
                                    </div>

                                    <button
                                        onClick={handleSearch}
                                        disabled={!canSearch}
                                        className={`w-full py-3 px-4 rounded-lg font-semibold transition-colors ${
                                            canSearch
                                                ? 'bg-wcg-blue text-white hover:bg-blue-700'
                                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        }`}
                                    >
                                        View My History
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <div>
                                {results.profile ? (
                                    <>
                                        <ChecklistModal 
                                            isOpen={modalOpen.isOpen}
                                            onClose={() => setModalOpen({ isOpen: false, type: null })}
                                            type={modalOpen.type}
                                            completedSessions={modalOpen.type === 'spark' ? metrics.uniqueSparks : metrics.uniqueDovetails}
                                            allSessions={results.allSessions}
                                        />

                                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <h2 className="text-2xl font-bold text-wcg-dark mb-2">
                                                        {results.profile.name}
                                                    </h2>
                                                    <p className="text-gray-600">
                                                        <span className="font-semibold">School:</span> {results.profile.school}
                                                    </p>
                                                    <p className="text-gray-600">
                                                        <span className="font-semibold">District:</span> {results.profile.district}
                                                    </p>
                                                    <p className="text-sm text-gray-500 mt-2">
                                                        Generated: {new Date().toLocaleDateString('en-GB')}
                                                    </p>
                                                </div>
                                                <button
                                                    onClick={() => setResults(null)}
                                                    className="no-print px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50"
                                                >
                                                    New Search
                                                </button>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                            <h3 className="text-lg font-semibold text-wcg-dark mb-4">Summary</h3>
                                            <div className="grid grid-cols-2 md:grid-cols-7 gap-4">
                                                <div className="text-center p-4 bg-gray-50 rounded-lg">
                                                    <div className="text-3xl font-bold text-wcg-dark">{metrics.total}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Total Sessions</div>
                                                </div>
                                                <div className="text-center p-4 bg-wcg-green/10 rounded-lg">
                                                    <div className="text-3xl font-bold text-wcg-green">{metrics.byLevel['Laying the Foundation']}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Foundation</div>
                                                </div>
                                                <div className="text-center p-4 bg-wcg-yellow/10 rounded-lg">
                                                    <div className="text-3xl font-bold text-wcg-yellow">{metrics.byLevel['I can do it']}</div>
                                                    <div className="text-sm text-gray-600 mt-1">I Can Do It</div>
                                                </div>
                                                <div className="text-center p-4 bg-wcg-red/10 rounded-lg">
                                                    <div className="text-3xl font-bold text-wcg-red">{metrics.byLevel['I can do it better']}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Better</div>
                                                </div>
                                                <div className="text-center p-4 bg-wcg-blue/10 rounded-lg">
                                                    <div className="text-3xl font-bold text-wcg-blue">{metrics.byLevel['The Summit']}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Summit</div>
                                                </div>
                                                <div 
                                                    className="text-center p-4 bg-wcg-yellow/10 rounded-lg cursor-pointer hover:bg-wcg-yellow/20 transition-colors no-print"
                                                    onClick={() => setModalOpen({ isOpen: true, type: 'spark' })}
                                                    title="Click to view checklist"
                                                >
                                                    <div className="text-3xl font-bold text-wcg-yellow">‚≠ê {metrics.totalSparks}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Sparks</div>
                                                </div>
                                                <div 
                                                    className="text-center p-4 bg-wcg-pink/10 rounded-lg cursor-pointer hover:bg-wcg-pink/20 transition-colors no-print"
                                                    onClick={() => setModalOpen({ isOpen: true, type: 'dovetail' })}
                                                    title="Click to view checklist"
                                                >
                                                    <div className="text-3xl font-bold text-wcg-pink">üíé {metrics.totalDovetails}</div>
                                                    <div className="text-sm text-gray-600 mt-1">Dovetail</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-md p-6 mb-6 no-print">
                                            <div className="flex flex-wrap gap-4 items-end">
                                                <div className="flex-1 min-w-[180px]">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Development Level
                                                    </label>
                                                    <select
                                                        value={filters.level}
                                                        onChange={(e) => setFilters({...filters, level: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue text-sm"
                                                    >
                                                        <option value="">All Levels</option>
                                                        {filterOptions.levels.map(level => (
                                                            <option key={level} value={level}>{level}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div className="flex-1 min-w-[180px]">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Hosting District
                                                    </label>
                                                    <select
                                                        value={filters.district}
                                                        onChange={(e) => setFilters({...filters, district: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue text-sm"
                                                    >
                                                        <option value="">All Districts</option>
                                                        {filterOptions.districts.map(district => (
                                                            <option key={district} value={district}>{district}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div className="flex-1 min-w-[180px]">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Delivery Mode
                                                    </label>
                                                    <select
                                                        value={filters.mode}
                                                        onChange={(e) => setFilters({...filters, mode: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue text-sm"
                                                    >
                                                        <option value="">All Modes</option>
                                                        {filterOptions.modes.map(mode => (
                                                            <option key={mode} value={mode}>{mode}</option>
                                                        ))}
                                                    </select>
                                                </div>

                                                <div className="flex-1 min-w-[180px]">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Category
                                                    </label>
                                                    <select
                                                        value={filters.category}
                                                        onChange={(e) => setFilters({...filters, category: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue text-sm"
                                                    >
                                                        <option value="">All Sessions</option>
                                                        <option value="spark">‚≠ê Sparks Only</option>
                                                        <option value="dovetail">üíé Dovetail Only</option>
                                                    </select>
                                                </div>

                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setViewMode('cards')}
                                                        className={`px-4 py-2 rounded-lg border-2 transition-colors text-sm ${
                                                            viewMode === 'cards'
                                                                ? 'border-wcg-blue bg-wcg-blue text-white'
                                                                : 'border-gray-300 text-gray-700 hover:border-wcg-blue'
                                                        }`}
                                                    >
                                                        Cards
                                                    </button>
                                                    <button
                                                        onClick={() => setViewMode('table')}
                                                        className={`px-4 py-2 rounded-lg border-2 transition-colors text-sm ${
                                                            viewMode === 'table'
                                                                ? 'border-wcg-blue bg-wcg-blue text-white'
                                                                : 'border-gray-300 text-gray-700 hover:border-wcg-blue'
                                                        }`}
                                                    >
                                                        Table
                                                    </button>
                                                </div>

                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={exportToCSV}
                                                        className="px-4 py-2 bg-wcg-green text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                                    >
                                                        Download CSV
                                                    </button>
                                                    <button
                                                        onClick={() => window.print()}
                                                        className="px-4 py-2 bg-wcg-purple text-white rounded-lg hover:bg-purple-700 transition-colors text-sm"
                                                    >
                                                        Print / PDF
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        {filteredSessions.length === 0 ? (
                                            <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                                <p className="text-gray-600">No sessions found matching the selected filters.</p>
                                            </div>
                                        ) : viewMode === 'cards' ? (
                                            <div className="space-y-8">
                                                {sessionsByYear.map(({ year, sessions }) => (
                                                    <div key={year}>
                                                        <h3 className="text-xl font-bold text-wcg-dark mb-4 pb-2 border-b-2 border-wcg-blue">
                                                            {year}
                                                        </h3>
                                                        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                                                            {sessions.map((session, idx) => (
                                                                <div 
                                                                    key={idx} 
                                                                    className={`bg-white rounded-lg shadow-md p-5 hover:shadow-lg transition-shadow relative overflow-hidden ${
                                                                        session.isSpark ? 'border-2 border-wcg-yellow spark-overlay' : 
                                                                        session.isDovetail ? 'border-2 border-wcg-pink dovetail-overlay' : ''
                                                                    }`}
                                                                >
                                                                    {session.isSpark && (
                                                                        <div className="absolute top-2 right-2 bg-wcg-yellow text-black px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                                                                            ‚≠ê Spark
                                                                        </div>
                                                                    )}
                                                                    {session.isDovetail && (
                                                                        <div className="absolute top-2 right-2 bg-wcg-pink text-white px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                                                                            üíé Dovetail
                                                                        </div>
                                                                    )}
                                                                    
                                                                    <div className="flex justify-between items-start mb-3">
                                                                        <span className={`px-3 py-1 rounded-full text-xs font-semibold ${getLevelColor(session['Development Level'])}`}>
                                                                            {session['Development Level'] || 'N/A'}
                                                                        </span>
                                                                        <span className="text-sm text-gray-500">
                                                                            {formatDate(session.parsedDate)}
                                                                        </span>
                                                                    </div>
                                                                    <h4 className="font-semibold text-wcg-dark mb-3 line-clamp-2 pr-20">
                                                                        {session['Session Name'] || 'Untitled Session'}
                                                                    </h4>
                                                                    <div className="space-y-1 text-sm text-gray-600">
                                                                        <p><span className="font-medium">Facilitator:</span> {session['Facilitator'] || 'N/A'}</p>
                                                                        <p><span className="font-medium">District:</span> {session['Hosting District'] || 'N/A'}</p>
                                                                        <p><span className="font-medium">Mode:</span> {session['Delivery Mode'] || 'N/A'}</p>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="bg-white rounded-lg shadow-md overflow-hidden">
                                                <div className="overflow-x-auto">
                                                    <table className="w-full">
                                                        <thead className="bg-gray-50 border-b">
                                                            <tr>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Date</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Session Name</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Level</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Facilitator</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">District</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Mode</th>
                                                                <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase">Special</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-gray-200">
                                                            {filteredSessions.map((session, idx) => (
                                                                <tr 
                                                                    key={idx} 
                                                                    className={`hover:bg-gray-50 ${
                                                                        session.isSpark ? 'spark-overlay' : 
                                                                        session.isDovetail ? 'dovetail-overlay' : ''
                                                                    }`}
                                                                >
                                                                    <td className="px-4 py-3 text-sm text-gray-900 whitespace-nowrap">
                                                                        {formatDate(session.parsedDate)}
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm text-gray-900">
                                                                        {session['Session Name'] || 'Untitled Session'}
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm">
                                                                        <span className={`px-2 py-1 rounded text-xs font-semibold ${getLevelColor(session['Development Level'])}`}>
                                                                            {session['Development Level'] || 'N/A'}
                                                                        </span>
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm text-gray-700">
                                                                        {session['Facilitator'] || 'N/A'}
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm text-gray-700">
                                                                        {session['Hosting District'] || 'N/A'}
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm text-gray-700">
                                                                        {session['Delivery Mode'] || 'N/A'}
                                                                    </td>
                                                                    <td className="px-4 py-3 text-sm">
                                                                        {session.isSpark && (
                                                                            <span className="inline-flex items-center gap-1 bg-wcg-yellow text-black px-2 py-1 rounded text-xs font-bold">
                                                                                ‚≠ê Spark
                                                                            </span>
                                                                        )}
                                                                        {session.isDovetail && (
                                                                            <span className="inline-flex items-center gap-1 bg-wcg-pink text-white px-2 py-1 rounded text-xs font-bold">
                                                                                üíé Dovetail
                                                                            </span>
                                                                        )}
                                                                    </td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    <div className="max-w-2xl mx-auto">
                                        <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                            <div className="text-gray-400 mb-4">
                                                <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                            <h3 className="text-xl font-semibold text-gray-900 mb-2">No Records Found</h3>
                                            <p className="text-gray-600 mb-6">
                                                No professional development records were found for the {searchType === 'id' ? 'ID' : 'PERSAL'} number you entered. 
                                                Please check your details and try again.
                                            </p>
                                            <button
                                                onClick={() => setResults(null)}
                                                className="px-6 py-2 bg-wcg-blue text-white rounded-lg hover:bg-blue-700 transition-colors"
                                            >
                                                Try Again
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>