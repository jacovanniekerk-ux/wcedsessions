<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WCG Sessions - Calendar & Tile View</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wcg: {
                            blue: '#004B87',
                            red: '#EE3B3B',
                            grey: '#968C83',
                            light: '#F3F4F6'
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse-custom 1.5s infinite',
                    },
                    keyframes: {
                        'pulse-custom': {
                            '0%, 100%': { transform: 'scale(1)', opacity: '1' },
                            '50%': { transform: 'scale(1.05)', opacity: '0.9' },
                        }
                    }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', 'Montserrat', sans-serif; }
        .calendar-grid { display: grid; grid-template-columns: repeat(5, 1fr); } /* Mon-Fri only */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- ICONS ---
        const Icons = {
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Grid: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ExternalLink: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
        };

        const App = () => {
            const [view, setView] = useState('calendar'); // 'calendar' or 'tiles'
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(null); // For mobile detail view

            const FILE_NAME = 'Upcoming Sessions - Scheduled Sessions.csv';

            useEffect(() => {
                Papa.parse(FILE_NAME, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const mapped = results.data.map((row, index) => {
                            const getVal = (key) => {
                                const foundKey = Object.keys(row).find(k => k.trim().toLowerCase() === key.toLowerCase());
                                return foundKey ? row[foundKey] : '';
                            };
                            return {
                                id: index,
                                dateStr: getVal('Date'),
                                time: getVal('Time'),
                                name: getVal('Session Name'),
                                district: getVal('HOSTING DISTRICT'),
                                registerLink: getVal('Pre-Register'),
                                joinLink: getVal('Join Link')
                            };
                        }).filter(s => s.name);
                        setData(mapped);
                        setLoading(false);
                    }
                });
            }, []);

            const parseDate = (dStr) => {
                if (!dStr) return null;
                const parts = dStr.split('/');
                return parts.length === 3 ? new Date(parts[2], parts[1] - 1, parts[0]) : new Date(dStr);
            };

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // --- CALENDAR LOGIC ---
            const calendarDays = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                
                const days = [];
                // Fill leading empty slots (Mon-Fri logic)
                let startOffset = firstDay.getDay(); // 0 is Sun, 1 is Mon
                if (startOffset === 0) startOffset = 7; // Treat Sun as 7
                
                // We only show Mon-Fri (1-5)
                // If month starts on Sat(6) or Sun(0), we handle carefully
                
                for (let d = 1; d <= lastDay.getDate(); d++) {
                    const date = new Date(year, month, d);
                    const dayOfWeek = date.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Skip weekends
                        days.push(date);
                    }
                }
                return days;
            }, [currentMonth]);

            const sessionsByDate = (date) => {
                return data.filter(s => {
                    const sDate = parseDate(s.dateStr);
                    return sDate && sDate.toDateString() === date.toDateString();
                });
            };

            const navigateMonth = (direction) => {
                const newMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + direction, 1);
                // Don't navigate to months entirely in the past
                const lastDayOfNewMonth = new Date(newMonth.getFullYear(), newMonth.getMonth() + 1, 0);
                if (lastDayOfNewMonth < today && direction < 0) return;
                setCurrentMonth(newMonth);
            };

            if (loading) return <div className="h-screen flex items-center justify-center"><div className="animate-spin h-8 w-8 border-4 border-wcg-blue border-t-transparent rounded-full"></div></div>;

            return (
                <div className="min-h-screen bg-gray-50 flex flex-col">
                    {/* Header */}
                    <header className="bg-white border-b sticky top-0 z-40 p-4">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
                            <img src="header.png" alt="WCG Logo" className="h-10 md:h-12" />
                            
                            <div className="flex bg-gray-100 p-1 rounded-lg">
                                <button 
                                    onClick={() => setView('calendar')}
                                    className={`flex items-center gap-2 px-4 py-1.5 rounded-md text-sm font-bold transition-all ${view === 'calendar' ? 'bg-white shadow-sm text-wcg-blue' : 'text-gray-500'}`}
                                >
                                    <Icons.Calendar /> Calendar
                                </button>
                                <button 
                                    onClick={() => setView('tiles')}
                                    className={`flex items-center gap-2 px-4 py-1.5 rounded-md text-sm font-bold transition-all ${view === 'tiles' ? 'bg-white shadow-sm text-wcg-blue' : 'text-gray-500'}`}
                                >
                                    <Icons.Grid /> Tiles
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-grow max-w-7xl w-full mx-auto p-4">
                        {view === 'calendar' ? (
                            <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                                {/* Calendar Controls */}
                                <div className="flex items-center justify-between p-6 border-b">
                                    <h2 className="text-xl font-bold text-wcg-blue font-accent">
                                        {currentMonth.toLocaleString('default', { month: 'long', year: 'numeric' })}
                                    </h2>
                                    <div className="flex gap-2">
                                        <button onClick={() => navigateMonth(-1)} className="p-2 hover:bg-gray-100 rounded-full text-wcg-blue"><Icons.ChevronLeft /></button>
                                        <button onClick={() => navigateMonth(1)} className="p-2 hover:bg-gray-100 rounded-full text-wcg-blue"><Icons.ChevronRight /></button>
                                    </div>
                                </div>

                                {/* Calendar Week Headers */}
                                <div className="calendar-grid bg-gray-50 border-b text-center py-3">
                                    {['Mon', 'Tue', 'Wed', 'Thu', 'Fri'].map(d => (
                                        <div key={d} className="text-[10px] uppercase tracking-widest font-bold text-gray-400">{d}</div>
                                    ))}
                                </div>

                                {/* Calendar Body */}
                                <div className="calendar-grid bg-white min-h-[400px]">
                                    {/* Empty cells for start of month alignment */}
                                    {Array.from({ length: (new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay() + 6) % 7 }).map((_, i) => {
                                        // Simple logic to skip weekend offsets
                                        const dayIdx = (new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay());
                                        if (i >= 5) return null; // Simple Mon-Fri grid safety
                                        return <div key={`empty-${i}`} className="border-r border-b border-gray-100 bg-gray-50/30"></div>;
                                    })}

                                    {calendarDays.map(date => {
                                        const sessions = sessionsByDate(date);
                                        const isPast = date < today;
                                        const isToday = date.toDateString() === today.toDateString();

                                        return (
                                            <div 
                                                key={date.toISOString()} 
                                                onClick={() => setSelectedDate(date)}
                                                className={`min-h-[100px] md:min-h-[140px] border-r border-b border-gray-100 p-2 transition-colors cursor-pointer hover:bg-blue-50/30 relative
                                                    ${isToday ? 'bg-blue-50/50' : ''}
                                                    ${isPast ? 'bg-gray-50/20' : ''}
                                                `}
                                            >
                                                <span className={`text-xs font-bold ${isToday ? 'bg-wcg-blue text-white w-6 h-6 flex items-center justify-center rounded-full' : 'text-gray-400'}`}>
                                                    {date.getDate()}
                                                </span>

                                                <div className="mt-2 space-y-1">
                                                    {sessions.map(s => (
                                                        <div key={s.id} className="hidden md:block">
                                                            <div className={`text-[10px] leading-tight p-1 rounded border shadow-sm ${isPast ? 'bg-gray-100 text-gray-400 border-gray-200' : 'bg-white text-wcg-blue border-blue-100'}`}>
                                                                <div className="font-bold truncate">{s.name}</div>
                                                                <div className="flex items-center gap-1 mt-0.5 opacity-70">
                                                                    <Icons.Clock /> {s.time}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {/* Mobile Indicators */}
                                                    {sessions.length > 0 && (
                                                        <div className="flex flex-wrap gap-1 md:hidden">
                                                            {sessions.map(s => (
                                                                <div key={s.id} className={`w-2 h-2 rounded-full ${isPast ? 'bg-gray-300' : 'bg-wcg-blue'}`}></div>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            /* TILE VIEW (from previous requirements) */
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                {data.filter(s => parseDate(s.dateStr) >= today).sort((a,b) => parseDate(a.dateStr) - parseDate(b.dateStr)).map(s => (
                                    <TileCard key={s.id} session={s} isToday={parseDate(s.dateStr).toDateString() === today.toDateString()} />
                                ))}
                            </div>
                        )}
                    </main>

                    {/* Mobile Detail Modal / Sidebar for Calendar */}
                    {selectedDate && (
                        <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center p-0 md:p-4 bg-black/40 backdrop-blur-sm" onClick={() => setSelectedDate(null)}>
                            <div className="bg-white w-full max-w-lg rounded-t-3xl md:rounded-2xl shadow-2xl overflow-hidden animate-slide-up" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b flex justify-between items-center">
                                    <div>
                                        <h3 className="text-wcg-blue font-bold text-lg">{selectedDate.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'long' })}</h3>
                                        <p className="text-gray-500 text-sm">Scheduled Sessions</p>
                                    </div>
                                    <button onClick={() => setSelectedDate(null)} className="text-gray-400 hover:text-gray-600 font-bold text-2xl">&times;</button>
                                </div>
                                <div className="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                                    {sessionsByDate(selectedDate).length > 0 ? (
                                        sessionsByDate(selectedDate).map(s => {
                                            const isPast = selectedDate < today;
                                            const isToday = selectedDate.toDateString() === today.toDateString();
                                            return (
                                                <div key={s.id} className="p-4 rounded-xl border border-gray-100 bg-gray-50">
                                                    <h4 className="font-bold text-gray-900 mb-1">{s.name}</h4>
                                                    <div className="flex items-center gap-3 text-xs text-gray-500 mb-4">
                                                        <span className="flex items-center gap-1"><Icons.Clock /> {s.time}</span>
                                                        <span className="bg-white px-2 py-0.5 rounded border">{s.district}</span>
                                                    </div>
                                                    {isToday ? (
                                                        <a href={s.joinLink} target="_blank" className="block w-full text-center bg-wcg-red text-white font-bold py-3 rounded-lg animate-pulse-fast shadow-md text-sm uppercase tracking-widest">Join Now</a>
                                                    ) : isPast ? (
                                                        <button disabled className="w-full bg-gray-200 text-gray-400 font-bold py-2 rounded-lg text-sm cursor-not-allowed">Concluded</button>
                                                    ) : (
                                                        <a href={s.registerLink} target="_blank" className="block w-full text-center bg-wcg-blue text-white font-bold py-2 rounded-lg text-sm shadow-sm">Register Now</a>
                                                    )}
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div className="text-center py-10 text-gray-400 italic">No sessions scheduled for this day.</div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const TileCard = ({ session, isToday }) => (
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-5 flex flex-col hover:shadow-md transition-all">
                <div className="flex justify-between items-start mb-4">
                    <span className="text-wcg-blue font-bold text-sm bg-blue-50 px-3 py-1 rounded-full">{session.dateStr}</span>
                    <span className="text-xs text-gray-400 font-bold uppercase">{session.district}</span>
                </div>
                <h3 className="font-bold text-lg mb-2 leading-tight text-gray-900">{session.name}</h3>
                <div className="flex items-center gap-1.5 text-gray-500 text-xs mb-6">
                    <Icons.Clock /> {session.time}
                </div>
                <div className="mt-auto">
                    {isToday ? (
                        <a href={session.joinLink} target="_blank" className="block w-full text-center bg-wcg-red text-white font-bold py-3 rounded-lg animate-pulse-fast shadow-md text-sm uppercase tracking-widest">Join Now</a>
                    ) : (
                        <a href={session.registerLink} target="_blank" className="block w-full text-center bg-wcg-blue text-white font-bold py-2.5 rounded-lg text-white hover:bg-blue-800 transition-colors text-sm">Pre-Register</a>
                    )}
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>