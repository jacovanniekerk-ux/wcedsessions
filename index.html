<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Sessions | Western Cape Government</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wcg: {
                            blue: '#004B87',        
                            grey: '#968C83',        
                            red: '#EE3B3B',         
                            yellow: '#FFD700',      
                            green: '#32CD32',       
                            darkText: '#333333',
                            lightBg: '#F8FAFC'
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        accent: ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');
        .font-accent { font-family: 'Montserrat', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
    </style>
</head>
<body class="bg-wcg-lightBg min-h-screen text-wcg-darkText">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Helper to parse the CSV format and handle date logic
        const parseCSV = (text) => {
            const lines = text.split('\n');
            const headers = lines[0].split(',');
            const currentYear = new Date().getFullYear();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            return lines.slice(1)
                .filter(line => line.trim() !== '' && !line.startsWith(',,,,'))
                .map((line, index) => {
                    // Regex to handle commas inside quotes
                    const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
                    const cleanValues = values.map(v => v.replace(/^"|"$/g, '').trim());
                    
                    const dateStr = cleanValues[0]; // e.g., "Tue, Jan 27"
                    const timeStr = cleanValues[1]; // e.g., "14:30 - 16:00"
                    
                    // Create a valid JS Date object for comparison
                    // We assume current year since CSV only has Month/Day
                    const parsedDate = new Date(`${dateStr}, ${currentYear}`);
                    parsedDate.setHours(0, 0, 0, 0);

                    return {
                        id: index,
                        dateRaw: dateStr,
                        dateObj: parsedDate,
                        time: timeStr,
                        term: cleanValues[2],
                        district: cleanValues[3],
                        name: cleanValues[4],
                        level: cleanValues[5],
                        description: cleanValues[6],
                        points: cleanValues[7],
                        registerLink: cleanValues[8],
                        googleCal: cleanValues[9],
                        outlookCal: cleanValues[10],
                        joinLink: cleanValues[11]
                    };
                })
                .filter(session => session.dateObj >= today) // Filter out past sessions
                .sort((a, b) => a.dateObj - b.dateObj); // Sort by date
        };

        const SessionCard = ({ session }) => {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const isToday = session.dateObj.getTime() === today.getTime();

            return (
                <div className="glass-card rounded-2xl p-6 shadow-sm hover:shadow-md transition-all duration-300 flex flex-col h-full border-l-4 border-l-wcg-blue">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <p className="text-wcg-blue font-bold text-lg leading-tight">{session.dateRaw}</p>
                            <p className="text-gray-500 text-sm font-medium mt-1">
                                <span className="inline-block mr-1">üïí</span> {session.time}
                            </p>
                        </div>
                        <span className="bg-blue-50 text-wcg-blue text-[10px] uppercase tracking-widest font-bold px-2 py-1 rounded">
                            {session.term}
                        </span>
                    </div>

                    <h3 className="text-xl font-bold text-gray-800 mb-2 leading-tight min-h-[3rem]">
                        {session.name}
                    </h3>
                    
                    <div className="flex items-center gap-2 mb-4">
                        <span className="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded flex items-center gap-1">
                            üìç {session.district}
                        </span>
                        <span className="bg-wcg-yellow/10 text-yellow-700 text-xs px-2 py-1 rounded">
                            {session.level}
                        </span>
                    </div>

                    <p className="text-gray-600 text-sm line-clamp-3 mb-6 flex-grow">
                        {session.description}
                    </p>

                    <div className="mt-auto pt-4 border-t border-gray-100">
                        {isToday ? (
                            <a 
                                href={session.joinLink}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors animate-pulse"
                            >
                                <span className="relative flex h-3 w-3">
                                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"></span>
                                  <span className="relative inline-flex rounded-full h-3 w-3 bg-white"></span>
                                </span>
                                JOIN SESSION NOW
                            </a>
                        ) : (
                            <div className="space-y-3">
                                <a 
                                    href={session.registerLink}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="w-full bg-wcg-blue hover:bg-blue-900 text-white font-bold py-2.5 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors text-sm"
                                >
                                    Pre-register
                                </a>
                                <div className="grid grid-cols-2 gap-2">
                                    <a href={session.googleCal} target="_blank" className="text-[11px] text-gray-500 hover:text-wcg-blue flex items-center justify-center gap-1 bg-gray-50 py-2 rounded-md transition-colors">
                                        + Google
                                    </a>
                                    <a href={session.outlookCal} target="_blank" className="text-[11px] text-gray-500 hover:text-wcg-blue flex items-center justify-center gap-1 bg-gray-50 py-2 rounded-md transition-colors">
                                        + Outlook
                                    </a>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [sessions, setSessions] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetch('Upcoming Sessions - Scheduled Sessions.csv')
                    .then(res => res.text())
                    .then(data => {
                        setSessions(parseCSV(data));
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error("Error loading CSV:", err);
                        setLoading(false);
                    });
            }, []);

            const groupedSessions = useMemo(() => {
                return sessions.reduce((acc, session) => {
                    const month = session.dateObj.toLocaleString('default', { month: 'long' });
                    if (!acc[month]) acc[month] = [];
                    acc[month].push(session);
                    return acc;
                }, {});
            }, [sessions]);

            return (
                <div className="max-w-7xl mx-auto px-4 py-12">
                    <header className="mb-16 text-center">
                        <div className="inline-block bg-wcg-blue text-white text-xs font-bold tracking-[0.2em] px-4 py-2 rounded-full mb-6 uppercase">
                            Professional Development
                        </div>
                        <h1 className="text-4xl md:text-6xl font-black text-wcg-blue font-accent mb-4 tracking-tight">
                            UPCOMING SESSIONS
                        </h1>
                        <p className="text-gray-500 max-w-2xl mx-auto text-lg">
                            Empowering our educators with world-class digital skills and pedagogical tools.
                        </p>
                    </header>

                    {loading ? (
                        <div className="flex justify-center py-20">
                            <div className="animate-spin rounded-full h-12 w-12 border-4 border-wcg-blue border-t-transparent"></div>
                        </div>
                    ) : sessions.length === 0 ? (
                        <div className="text-center py-20 bg-white rounded-3xl shadow-sm border border-gray-100">
                            <p className="text-xl text-gray-400 font-medium">No upcoming sessions scheduled at this time.</p>
                        </div>
                    ) : (
                        Object.keys(groupedSessions).map(month => (
                            <section key={month} className="mb-16">
                                <div className="flex items-center gap-4 mb-8">
                                    <h2 className="text-2xl font-black text-wcg-blue font-accent tracking-tighter uppercase">{month}</h2>
                                    <div className="h-px bg-gray-200 flex-grow"></div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    {groupedSessions[month].map(session => (
                                        <SessionCard key={session.id} session={session} />
                                    ))}
                                </div>
                            </section>
                        ))
                    )}

                    <footer className="mt-20 py-10 border-t border-gray-200 text-center">
                        <p className="text-xs font-accent font-bold text-gray-400 tracking-widest uppercase">
                            ¬© 2026 Western Cape Government ‚Ä¢ Education Department
                        </p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
