<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School PD Report - WCED Professional Development</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'wcg-green': '#76B82A',
                        'wcg-yellow': '#FDB913',
                        'wcg-red': '#E30613',
                        'wcg-blue': '#001489',
                        'wcg-purple': '#672D82',
                        'wcg-pink': '#C8126E',
                        'wcg-dark': '#1a1a1a',
                        'wcg-gray': '#666666'
                    },
                    fontFamily: {
                        'sans': ['Century Gothic', 'Arial', 'Helvetica', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background: white !important;
            }
            .print-full-width {
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // *** UPDATE THIS DATE WHEN YOU UPDATE THE CSV FILE ***
        const DATA_LAST_UPDATED = '2025-01-28'; // Format: YYYY-MM-DD
        // *****************************************************

        // Sparks and Dovetail definitions
        const SPARK_SESSIONS = [
            'Adoption Strategy',
            'Digital Skills Course',
            'Facilitator Think Tank',
            'Cyber Effect Ambassador Initiation Course'
        ];

        const DOVETAIL_SESSIONS = [
            'ePedagogy: Building a Digital Lesson',
            'Integrating digital resources from the ePortal',
            'Google Fundamentals 1: Account and Google Chrome',
            'Office Online Fundamentals',
            'Improved Presentation Skills',
            'Ease of Access with QR Codes and Bit.ly links',
            'Teaching with Videos',
            'Orientation to Google Forms',
            'AI In Education: Work Smarter, not Harder',
            'Introduction to Cyber Wellness Education'
        ];

        // Utility functions
        function parseTimestamp(timestamp) {
            if (!timestamp) return null;
            try {
                const [datePart] = timestamp.split(' ');
                const [day, month, year] = datePart.split('/');
                return new Date(year, month - 1, day);
            } catch {
                return null;
            }
        }

        function formatDate(dateObj) {
            if (!dateObj) return 'N/A';
            const day = String(dateObj.getDate()).padStart(2, '0');
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const year = dateObj.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function getQuarter(date) {
            if (!date) return null;
            const month = date.getMonth();
            return Math.floor(month / 3) + 1;
        }

        function getLevelColor(level) {
            if (!level) return 'bg-gray-200 text-gray-800';
            const normalized = level.toLowerCase().trim();
            if (normalized === 'laying the foundation') return 'bg-wcg-green text-white';
            if (normalized === 'i can do it') return 'bg-wcg-yellow text-black';
            if (normalized === 'i can do it better') return 'bg-wcg-red text-white';
            if (normalized === 'the summit') return 'bg-wcg-blue text-white';
            return 'bg-gray-200 text-gray-800';
        }

        function isSpark(sessionName) {
            return SPARK_SESSIONS.includes(sessionName?.trim());
        }

        function isDovetail(sessionName) {
            return DOVETAIL_SESSIONS.includes(sessionName?.trim());
        }

        function getModeIcon(mode) {
            if (!mode) return 'üìã';
            const normalized = mode.trim().toLowerCase();
            if (normalized === 'virtual') return 'üñ•Ô∏è';
            if (normalized === 'face-to-face') return 'üè¢';
            if (normalized === 'hybrid') return 'üîÑ';
            if (normalized === 'self-paced') return 'üìö';
            return 'üìã';
        }

        function getURLParameter(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        function App() {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [schoolName, setSchoolName] = useState('');
            const [schoolData, setSchoolData] = useState([]);
            const [filters, setFilters] = useState({
                years: [],
                level: '',
                mode: ''
            });
            const [expandedTeachers, setExpandedTeachers] = useState(new Set());
            const [expandedSessions, setExpandedSessions] = useState(new Set());
            const [teacherSort, setTeacherSort] = useState('name'); // 'name', 'attendance', 'sparks'

            const quarterChartRef = useRef(null);
            const pieChartRef = useRef(null);
            const quarterChartInstance = useRef(null);
            const pieChartInstance = useRef(null);

            // Get school name from URL
            useEffect(() => {
                const school = getURLParameter('school');
                if (school) {
                    setSchoolName(decodeURIComponent(school));
                }
            }, []);

            // Load CSV
            useEffect(() => {
                Papa.parse('attendance.csv', {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (result) => {
                        setData(result.data);
                        setLoading(false);
                    },
                    error: (error) => {
                        console.error('Error loading CSV:', error);
                        setLoading(false);
                    }
                });
            }, []);

            // Filter data for the selected school
            useEffect(() => {
                if (!schoolName || !data.length) return;

                const filtered = data
                    .filter(record => record.School?.trim() === schoolName)
                    .map(record => ({
                        ...record,
                        parsedDate: parseTimestamp(record.Timestamp),
                        year: parseTimestamp(record.Timestamp)?.getFullYear(),
                        quarter: getQuarter(parseTimestamp(record.Timestamp)),
                        isSpark: isSpark(record['Session Name']),
                        isDovetail: isDovetail(record['Session Name'])
                    }))
                    .filter(record => record.parsedDate); // Only valid dates

                setSchoolData(filtered);

                // Auto-select only current and previous year
                const currentYear = new Date().getFullYear();
                const previousYear = currentYear - 1;
                const years = [...new Set(filtered.map(r => r.year))].sort();
                const defaultYears = years.filter(y => y === currentYear || y === previousYear);
                
                setFilters(prev => ({ ...prev, years: defaultYears }));
            }, [schoolName, data]);

            // Get available years for checkboxes
            const availableYears = useMemo(() => {
                return [...new Set(schoolData.map(r => r.year))].sort();
            }, [schoolData]);

            // Apply filters
            const filteredData = useMemo(() => {
                let filtered = schoolData;

                if (filters.years.length > 0) {
                    filtered = filtered.filter(r => filters.years.includes(r.year));
                }

                if (filters.level) {
                    filtered = filtered.filter(r => 
                        r['Development Level']?.toLowerCase().trim() === filters.level.toLowerCase().trim()
                    );
                }

                if (filters.mode) {
                    filtered = filtered.filter(r => r['Delivery Mode']?.trim() === filters.mode);
                }

                return filtered;
            }, [schoolData, filters]);

            // Get filter options
            const filterOptions = useMemo(() => {
                const levels = [...new Set(schoolData.map(r => r['Development Level']?.trim()).filter(Boolean))];
                const modes = [...new Set(schoolData.map(r => r['Delivery Mode']?.trim()).filter(Boolean))].sort();
                return { levels, modes };
            }, [schoolData]);

            // Calculate quarterly data
            const quarterlyData = useMemo(() => {
                const quarters = {};
                
                filteredData.forEach(record => {
                    const key = `${record.year}-Q${record.quarter}`;
                    if (!quarters[key]) {
                        quarters[key] = {
                            label: key,
                            uniqueTeachers: new Set(),
                            totalAttendances: 0
                        };
                    }
                    quarters[key].uniqueTeachers.add(`${record['First Name']} ${record['Surname']}`);
                    quarters[key].totalAttendances++;
                });

                return Object.keys(quarters)
                    .sort()
                    .map(key => ({
                        label: key,
                        uniqueTeachers: quarters[key].uniqueTeachers.size,
                        totalAttendances: quarters[key].totalAttendances
                    }));
            }, [filteredData]);

            // Calculate level distribution
            const levelDistribution = useMemo(() => {
                const levels = {
                    'Laying the Foundation': 0,
                    'I can do it': 0,
                    'I can do it better': 0,
                    'The Summit': 0
                };

                filteredData.forEach(record => {
                    const level = record['Development Level']?.trim();
                    if (levels.hasOwnProperty(level)) {
                        levels[level]++;
                    }
                });

                return levels;
            }, [filteredData]);

            // Group by teachers
            const teacherData = useMemo(() => {
                const teachers = {};

                filteredData.forEach(record => {
                    const name = `${record['First Name']} ${record['Surname']}`.toUpperCase().trim();
                    if (!teachers[name]) {
                        teachers[name] = {
                            name,
                            sessions: [],
                            levelCounts: {
                                'Laying the Foundation': 0,
                                'I can do it': 0,
                                'I can do it better': 0,
                                'The Summit': 0
                            },
                            uniqueSparks: new Set(),
                            uniqueDovetails: new Set()
                        };
                    }

                    teachers[name].sessions.push(record);
                    const level = record['Development Level']?.trim();
                    if (teachers[name].levelCounts.hasOwnProperty(level)) {
                        teachers[name].levelCounts[level]++;
                    }

                    if (record.isSpark) {
                        teachers[name].uniqueSparks.add(record['Session Name']);
                    }
                    if (record.isDovetail) {
                        teachers[name].uniqueDovetails.add(record['Session Name']);
                    }
                });

                const teacherList = Object.values(teachers)
                    .map(t => ({
                        ...t,
                        totalSessions: t.sessions.length,
                        sparkCount: t.uniqueSparks.size + (t.uniqueDovetails.size >= 5 ? 1 : 0),
                        dovetailCount: t.uniqueDovetails.size
                    }));

                // Apply sorting
                if (teacherSort === 'name') {
                    teacherList.sort((a, b) => a.name.localeCompare(b.name));
                } else if (teacherSort === 'attendance') {
                    teacherList.sort((a, b) => b.totalSessions - a.totalSessions);
                } else if (teacherSort === 'sparks') {
                    teacherList.sort((a, b) => b.sparkCount - a.sparkCount);
                }

                return teacherList;
            }, [filteredData, teacherSort]);

            // Group by sessions
            const sessionData = useMemo(() => {
                const sessions = {};

                filteredData.forEach(record => {
                    const sessionName = record['Session Name']?.trim();
                    if (!sessionName) return;

                    if (!sessions[sessionName]) {
                        sessions[sessionName] = {
                            name: sessionName,
                            attendances: [],
                            level: record['Development Level'],
                            mode: record['Delivery Mode'],
                            isSpark: isSpark(sessionName),
                            isDovetail: isDovetail(sessionName)
                        };
                    }

                    const teacherName = `${record['First Name']} ${record['Surname']}`.toUpperCase().trim();
                    
                    sessions[sessionName].attendances.push({
                        teacher: teacherName,
                        date: record.parsedDate,
                        hostingDistrict: record['Hosting District'],
                        mode: record['Delivery Mode']
                    });
                });

                return Object.values(sessions)
                    .map(s => {
                        // Get unique teachers (keep most recent attendance for count)
                        const uniqueTeachers = {};
                        s.attendances.forEach(att => {
                            if (!uniqueTeachers[att.teacher] || att.date > uniqueTeachers[att.teacher].date) {
                                uniqueTeachers[att.teacher] = att;
                            }
                        });

                        return {
                            ...s,
                            attendanceList: s.attendances.sort((a, b) => b.date - a.date),
                            totalAttendances: s.attendances.length,
                            uniqueTeachers: Object.keys(uniqueTeachers).length
                        };
                    })
                    .sort((a, b) => b.totalAttendances - a.totalAttendances);
            }, [filteredData]);

            // Render quarter chart
            useEffect(() => {
                if (!quarterChartRef.current || quarterlyData.length === 0) return;

                if (quarterChartInstance.current) {
                    quarterChartInstance.current.destroy();
                }

                const ctx = quarterChartRef.current.getContext('2d');
                quarterChartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: quarterlyData.map(d => d.label),
                        datasets: [
                            {
                                label: 'Unique Teachers',
                                data: quarterlyData.map(d => d.uniqueTeachers),
                                backgroundColor: 'rgba(0, 20, 137, 0.7)',
                                borderColor: 'rgba(0, 20, 137, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Total Attendances',
                                data: quarterlyData.map(d => d.totalAttendances),
                                backgroundColor: 'rgba(118, 184, 42, 0.7)',
                                borderColor: 'rgba(118, 184, 42, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });

                return () => {
                    if (quarterChartInstance.current) {
                        quarterChartInstance.current.destroy();
                    }
                };
            }, [quarterlyData]);

            // Render pie chart
            useEffect(() => {
                if (!pieChartRef.current || Object.values(levelDistribution).every(v => v === 0)) return;

                if (pieChartInstance.current) {
                    pieChartInstance.current.destroy();
                }

                const ctx = pieChartRef.current.getContext('2d');
                pieChartInstance.current = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Laying the Foundation', 'I can do it', 'I can do it better', 'The Summit'],
                        datasets: [{
                            data: [
                                levelDistribution['Laying the Foundation'],
                                levelDistribution['I can do it'],
                                levelDistribution['I can do it better'],
                                levelDistribution['The Summit']
                            ],
                            backgroundColor: [
                                '#76B82A',
                                '#FDB913',
                                '#E30613',
                                '#001489'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right'
                            }
                        }
                    }
                });

                return () => {
                    if (pieChartInstance.current) {
                        pieChartInstance.current.destroy();
                    }
                };
            }, [levelDistribution]);

            // Toggle handlers
            const toggleTeacher = (name) => {
                setExpandedTeachers(prev => {
                    const next = new Set(prev);
                    if (next.has(name)) {
                        next.delete(name);
                    } else {
                        next.add(name);
                    }
                    return next;
                });
            };

            const toggleSession = (name) => {
                setExpandedSessions(prev => {
                    const next = new Set(prev);
                    if (next.has(name)) {
                        next.delete(name);
                    } else {
                        next.add(name);
                    }
                    return next;
                });
            };

            const toggleYear = (year) => {
                setFilters(prev => ({
                    ...prev,
                    years: prev.years.includes(year)
                        ? prev.years.filter(y => y !== year)
                        : [...prev.years, year].sort()
                }));
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-wcg-blue mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading attendance records...</p>
                        </div>
                    </div>
                );
            }

            if (!schoolName) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50">
                        <div className="max-w-2xl mx-auto px-4">
                            <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                <div className="text-red-500 mb-4">
                                    <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                </div>
                                <h3 className="text-xl font-semibold text-gray-900 mb-2">No School Selected</h3>
                                <p className="text-gray-600 mb-4">
                                    This page requires a school parameter in the URL.
                                </p>
                                <div className="bg-gray-100 p-4 rounded-lg text-left">
                                    <p className="text-sm text-gray-700 mb-2"><strong>Example URL format:</strong></p>
                                    <code className="text-xs bg-white px-2 py-1 rounded border">
                                        school-view.html?school=Mountain+View+High
                                    </code>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (schoolData.length === 0) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50">
                        <div className="max-w-2xl mx-auto px-4">
                            <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                <h3 className="text-xl font-semibold text-gray-900 mb-2">No Data Found</h3>
                                <p className="text-gray-600">
                                    No attendance records found for <strong>{schoolName}</strong>.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                            <img src="header.png" alt="WCED Header" className="h-16 mx-auto" />
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 print-full-width">
                        {/* School Header */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-wcg-dark mb-2">{schoolName}</h1>
                                    <p className="text-gray-600">Professional Development Report</p>
                                    <p className="text-sm text-gray-500 mt-2">
                                        Report Generated: {new Date().toLocaleDateString('en-GB')}
                                    </p>
                                    <p className="text-xs text-gray-400 mt-1">
                                        ‚ö†Ô∏è Based on static data last updated: {new Date(DATA_LAST_UPDATED).toLocaleDateString('en-GB')}
                                    </p>
                                </div>
                                <button
                                    onClick={() => window.print()}
                                    className="no-print px-4 py-2 bg-wcg-purple text-white rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Print / PDF
                                </button>
                            </div>
                        </div>

                        {/* Filters */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6 no-print">
                            <h3 className="text-lg font-semibold text-wcg-dark mb-4">Filters</h3>
                            
                            {/* Year Selection */}
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Years</label>
                                <div className="flex flex-wrap gap-3">
                                    {availableYears.map(year => (
                                        <label key={year} className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={filters.years.includes(year)}
                                                onChange={() => toggleYear(year)}
                                                className="h-4 w-4 text-wcg-blue border-gray-300 rounded focus:ring-wcg-blue"
                                            />
                                            <span className="text-sm text-gray-700">{year}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {/* Development Level Filter */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Development Level
                                    </label>
                                    <select
                                        value={filters.level}
                                        onChange={(e) => setFilters({...filters, level: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue"
                                    >
                                        <option value="">All Levels</option>
                                        {filterOptions.levels.map(level => (
                                            <option key={level} value={level}>{level}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* Delivery Mode Filter */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Delivery Mode
                                    </label>
                                    <select
                                        value={filters.mode}
                                        onChange={(e) => setFilters({...filters, mode: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue"
                                    >
                                        <option value="">All Modes</option>
                                        {filterOptions.modes.map(mode => (
                                            <option key={mode} value={mode}>{mode}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Charts */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            {/* Quarterly Trends */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h3 className="text-lg font-semibold text-wcg-dark mb-4">Quarterly Trends</h3>
                                <div className="h-64">
                                    <canvas ref={quarterChartRef}></canvas>
                                </div>
                            </div>

                            {/* Development Level Distribution */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h3 className="text-lg font-semibold text-wcg-dark mb-4">Development Level Distribution</h3>
                                <div className="h-64">
                                    <canvas ref={pieChartRef}></canvas>
                                </div>
                            </div>
                        </div>

                        {/* Teacher Attendance */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-semibold text-wcg-dark">Teacher Attendance</h3>
                                <div className="no-print">
                                    <label className="text-sm font-medium text-gray-700 mr-2">Sort by:</label>
                                    <select
                                        value={teacherSort}
                                        onChange={(e) => setTeacherSort(e.target.value)}
                                        className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-wcg-blue text-sm"
                                    >
                                        <option value="name">Name (A-Z)</option>
                                        <option value="attendance">Attendance (High-Low)</option>
                                        <option value="sparks">Sparks (High-Low)</option>
                                    </select>
                                </div>
                            </div>
                            <div className="space-y-2">
                                {teacherData.map(teacher => (
                                    <div key={teacher.name} className="border border-gray-200 rounded-lg">
                                        <div
                                            onClick={() => toggleTeacher(teacher.name)}
                                            className="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50"
                                        >
                                            <div className="flex items-center gap-3">
                                                <span className="text-wcg-blue">
                                                    {expandedTeachers.has(teacher.name) ? '‚ñº' : '‚ñ∂'}
                                                </span>
                                                <div>
                                                    <div className="font-semibold text-wcg-dark">{teacher.name}</div>
                                                    <div className="text-sm text-gray-600">
                                                        {teacher.totalSessions} sessions
                                                        {teacher.sparkCount > 0 && <span className="ml-3 text-wcg-yellow">‚≠ê {teacher.sparkCount} Sparks</span>}
                                                        {teacher.dovetailCount > 0 && <span className="ml-3 text-wcg-pink">üíé {teacher.dovetailCount} Dovetail</span>}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <span className={`px-2 py-1 rounded text-xs ${teacher.levelCounts['Laying the Foundation'] > 0 ? 'bg-wcg-green text-white' : 'bg-gray-200 text-gray-500'}`}>
                                                    {teacher.levelCounts['Laying the Foundation']}
                                                </span>
                                                <span className={`px-2 py-1 rounded text-xs ${teacher.levelCounts['I can do it'] > 0 ? 'bg-wcg-yellow text-black' : 'bg-gray-200 text-gray-500'}`}>
                                                    {teacher.levelCounts['I can do it']}
                                                </span>
                                                <span className={`px-2 py-1 rounded text-xs ${teacher.levelCounts['I can do it better'] > 0 ? 'bg-wcg-red text-white' : 'bg-gray-200 text-gray-500'}`}>
                                                    {teacher.levelCounts['I can do it better']}
                                                </span>
                                                <span className={`px-2 py-1 rounded text-xs ${teacher.levelCounts['The Summit'] > 0 ? 'bg-wcg-blue text-white' : 'bg-gray-200 text-gray-500'}`}>
                                                    {teacher.levelCounts['The Summit']}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        {expandedTeachers.has(teacher.name) && (
                                            <div className="px-4 pb-4 pt-2 bg-gray-50 border-t">
                                                <div className="space-y-2">
                                                    {teacher.sessions
                                                        .sort((a, b) => b.parsedDate - a.parsedDate)
                                                        .map((session, idx) => (
                                                            <div 
                                                                key={idx} 
                                                                className={`flex justify-between items-center text-sm py-2 px-3 rounded border-b last:border-0 ${
                                                                    session.isSpark ? 'border-l-4 border-l-wcg-yellow bg-wcg-yellow bg-opacity-5' :
                                                                    session.isDovetail ? 'border-l-4 border-l-wcg-pink bg-wcg-pink bg-opacity-5' :
                                                                    'border-gray-200'
                                                                }`}
                                                            >
                                                                <div className="flex-1">
                                                                    <div className="font-medium text-gray-900">
                                                                        {session.isSpark && <span className="mr-2">‚≠ê</span>}
                                                                        {session.isDovetail && <span className="mr-2">üíé</span>}
                                                                        {session['Session Name']}
                                                                    </div>
                                                                    <div className="text-gray-500 text-xs mt-1">
                                                                        {formatDate(session.parsedDate)} ‚Ä¢ {session['Delivery Mode']}
                                                                    </div>
                                                                </div>
                                                                <span className={`px-2 py-1 rounded text-xs font-semibold ${getLevelColor(session['Development Level'])}`}>
                                                                    {session['Development Level']}
                                                                </span>
                                                            </div>
                                                        ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Session Attendance */}
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h3 className="text-lg font-semibold text-wcg-dark mb-4">Session Attendance</h3>
                            <div className="space-y-2">
                                {sessionData.map(session => (
                                    <div 
                                        key={session.name} 
                                        className={`border rounded-lg ${
                                            session.isSpark ? 'border-wcg-yellow border-2' :
                                            session.isDovetail ? 'border-wcg-pink border-2' :
                                            'border-gray-200'
                                        }`}
                                    >
                                        <div
                                            onClick={() => toggleSession(session.name)}
                                            className="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50"
                                        >
                                            <div className="flex items-center gap-3 flex-1">
                                                <span className="text-wcg-blue">
                                                    {expandedSessions.has(session.name) ? '‚ñº' : '‚ñ∂'}
                                                </span>
                                                <div className="flex-1">
                                                    <div className="font-semibold text-wcg-dark">
                                                        {session.isSpark && <span className="mr-2">‚≠ê</span>}
                                                        {session.isDovetail && <span className="mr-2">üíé</span>}
                                                        {session.name}
                                                    </div>
                                                    <div className="text-sm text-gray-600">
                                                        {session.totalAttendances} attendances ‚Ä¢ {session.uniqueTeachers} unique teachers
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex gap-2 items-center">
                                                <span className={`px-2 py-1 rounded text-xs font-semibold ${getLevelColor(session.level)}`}>
                                                    {session.level}
                                                </span>
                                                <span className="text-xs text-gray-500">{getModeIcon(session.mode)} {session.mode}</span>
                                            </div>
                                        </div>
                                        
                                        {expandedSessions.has(session.name) && (
                                            <div className="px-4 pb-4 pt-2 bg-gray-50 border-t">
                                                <div className="space-y-2">
                                                    <div className="text-sm font-medium text-gray-700 mb-2">Attendance Records:</div>
                                                    {session.attendanceList.map((attendance, idx) => (
                                                        <div key={idx} className="flex justify-between items-center text-sm py-2 px-3 bg-white rounded border border-gray-200">
                                                            <div className="flex-1">
                                                                <span className="font-medium text-gray-900">{attendance.teacher}</span>
                                                            </div>
                                                            <div className="flex gap-4 items-center text-xs text-gray-600">
                                                                <span>üìÖ {formatDate(attendance.date)}</span>
                                                                <span>üìç {attendance.hostingDistrict || 'N/A'}</span>
                                                                <span>{getModeIcon(attendance.mode)} {attendance.mode || 'N/A'}</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
