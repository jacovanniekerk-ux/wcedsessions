<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Calendar - WCG</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wcg: {
                            blue: '#004B87',
                            grey: '#968C83',
                            red: '#EE3B3B',
                            yellow: '#FFD700',
                            green: '#32CD32',
                            darkText: '#333333',
                            lightBg: '#F3F4F6'
                        }
                    },
                    fontFamily: {
                        sans: ['Century Gothic', 'Didact Gothic', 'Segoe UI', 'sans-serif'],
                        accent: ['Gotham', 'Montserrat', 'sans-serif']
                    },
                    animation: {
                        'pulse-glow-stable': 'pulse-glow-stable 2s ease-in-out infinite',
                    },
                    keyframes: {
                        'pulse-glow-stable': {
                            '0%, 100%': { boxShadow: '0 0 0 0 rgba(238, 59, 59, 0.6)' },
                            '50%': { boxShadow: '0 0 15px 5px rgba(238, 59, 59, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Didact+Gothic&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { -webkit-font-smoothing: antialiased; font-family: 'Century Gothic', 'Segoe UI', sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden; }
        .calendar-day-cell { background-color: white; min-height: 110px; padding: 6px; transition: background 0.2s; }
        @media (max-width: 768px) { 
            .calendar-day-cell { min-height: 80px; padding: 4px; }
            .calendar-grid { grid-template-columns: repeat(7, 1fr); font-size: 0.7rem; }
        }
        .session-pill { transition: all 0.2s ease; cursor: pointer; }
        .session-pill:hover { transform: translateX(2px); filter: brightness(0.95); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-wcg-darkText">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const Icons = {
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Video: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            CalendarPlus: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><line x1="12" x2="12" y1="14" y2="18"/><line x1="10" x2="14" y1="16" y2="16"/></svg>
        };

        const parseDate = (dStr) => {
            if (!dStr) return null;
            const parts = dStr.split('/');
            return parts.length === 3 ? new Date(parts[2], parts[1] - 1, parts[0]) : new Date(dStr);
        };

        const isToday = (date) => {
            const today = new Date();
            return date && date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
        };

        const SessionModal = ({ session, onClose }) => {
            if (!session) return null;
            const level = session.level.toLowerCase();
            let color = 'bg-wcg-blue';
            if (level.includes('foundation')) color = 'bg-wcg-green';
            else if (level.includes('better')) color = 'bg-wcg-red';
            else if (level.includes('i can')) color = 'bg-wcg-yellow text-gray-900';

            const sessionDate = parseDate(session.date);
            const showJoinNow = isToday(sessionDate) && session.joinLink;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-all" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col fade-in" onClick={e => e.stopPropagation()}>
                        <div className={`h-2 w-full ${color.split(' ')[0]}`}></div>
                        <div className="p-6 overflow-y-auto hide-scrollbar">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <span className={`text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded border inline-block mb-2 ${color.includes('text-gray-900') ? 'bg-wcg-yellow text-gray-900 border-wcg-yellow' : color + ' text-white border-transparent'}`}>
                                        {session.level || 'General Session'}
                                    </span>
                                    <h2 className="text-2xl font-bold text-wcg-blue font-accent leading-tight">{session.name}</h2>
                                </div>
                                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><Icons.X /></button>
                            </div>
                            <div className="space-y-4 text-sm">
                                <div className="flex items-center gap-4 font-semibold text-gray-700">
                                    <span className="flex items-center gap-1"><Icons.Calendar /> {session.date}</span>
                                    <span className="flex items-center gap-1"><Icons.Clock /> {session.time}</span>
                                </div>
                                <div className="text-xs font-bold uppercase text-wcg-grey tracking-wider">District: {session.district}</div>
                                {session.description && (
                                    <div className="bg-blue-50/50 p-4 rounded-xl border border-blue-100/50">
                                        <h4 className="font-bold text-wcg-blue mb-1">Description</h4>
                                        <p className="text-gray-600 leading-relaxed">{session.description}</p>
                                    </div>
                                )}
                                {session.outcomes && (
                                    <div>
                                        <h4 className="font-bold text-gray-900 mb-1">Outcomes</h4>
                                        <p className="text-gray-600 italic leading-relaxed">{session.outcomes}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="p-6 bg-gray-50 border-t border-gray-100 flex flex-col sm:flex-row gap-3">
                            {showJoinNow ? (
                                <a href={session.joinLink} target="_blank" className="flex-1 bg-wcg-red text-white text-center py-3 rounded-lg font-bold text-sm animate-pulse-glow-stable shadow-md uppercase tracking-widest">Join Now</a>
                            ) : (
                                <a href={session.registerLink} target="_blank" className="flex-1 bg-wcg-blue text-white text-center py-3 rounded-lg font-bold text-sm hover:bg-blue-800 transition-colors uppercase tracking-widest">Pre-Register</a>
                            )}
                            <div className="flex gap-2 justify-center">
                                <a href={session.googleCal} target="_blank" title="Add to Google Calendar" className="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors"><Icons.CalendarPlus /></a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SessionPill = ({ session, onClick }) => {
            const level = session.level.toLowerCase();
            let style = 'bg-blue-50 text-wcg-blue border-wcg-blue';
            if (level.includes('foundation')) style = 'bg-green-50 text-green-700 border-wcg-green';
            else if (level.includes('better')) style = 'bg-red-50 text-red-700 border-wcg-red';
            else if (level.includes('i can')) style = 'bg-yellow-50 text-yellow-800 border-wcg-yellow';

            return (
                <div 
                    className={`session-pill mb-1 p-1.5 rounded text-[10px] leading-tight flex items-center gap-1 border-l-4 shadow-sm ${style}`}
                    onClick={(e) => { e.stopPropagation(); onClick(session); }}
                >
                    <span className="font-bold truncate flex-grow">{session.name}</span>
                    {session.joinLink && <Icons.Video />}
                </div>
            );
        };

        const App = () => {
            const [sessions, setSessions] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [selectedSession, setSelectedSession] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                Papa.parse('Upcoming Sessions - Scheduled Sessions.csv', {
                    download: true, header: true, skipEmptyLines: true,
                    complete: (results) => {
                        const mapped = results.data.map((row, i) => ({
                            id: i,
                            date: row['Date'] || '',
                            time: row['Time'] || '',
                            name: row['Session Name'] || 'Untitled',
                            district: row['HOSTING DISTRICT'] || 'Unspecified',
                            level: row['Developmental Level'] || '',
                            description: row['Session Description'] || row['Session Desciption'] || '',
                            outcomes: row['Session Outcomes'] || '',
                            registerLink: row['Pre-Register'] || '#',
                            joinLink: row['Join Link'] || '',
                            googleCal: row['Add To Calendar (Google)'] || '#',
                        })).filter(s => s.name !== 'Untitled');
                        setSessions(mapped);
                        setLoading(false);
                    }
                });
            }, []);

            const calendarDays = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const days = [];
                for (let i = 0; i < firstDay.getDay(); i++) days.push({ date: null });
                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const date = new Date(year, month, i);
                    days.push({ date, sessions: sessions.filter(s => {
                        const sd = parseDate(s.date);
                        return sd && sd.getDate() === i && sd.getMonth() === month && sd.getFullYear() === year;
                    })});
                }
                return days;
            }, [currentMonth, sessions]);

            const changeMonth = (offset) => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + offset, 1));

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-40 p-4">
                        <div className="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-4">
                            <h1 className="text-xl font-bold text-wcg-blue font-accent uppercase tracking-tighter">Session Calendar</h1>
                            <div className="flex items-center gap-4">
                                <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-gray-100 rounded-full"><Icons.ChevronLeft /></button>
                                <span className="font-bold text-lg min-w-[150px] text-center font-accent">
                                    {currentMonth.toLocaleString('default', { month: 'long', year: 'numeric' })}
                                </span>
                                <button onClick={() => changeMonth(1)} className="p-2 hover:bg-gray-100 rounded-full"><Icons.ChevronRight /></button>
                                <button onClick={() => setCurrentMonth(new Date())} className="text-xs font-bold text-wcg-blue border-b border-wcg-blue ml-2">TODAY</button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-grow max-w-7xl w-full mx-auto p-4 sm:p-6">
                        <div className="grid grid-cols-7 mb-2 text-center text-[10px] font-bold uppercase tracking-widest text-gray-400">
                            {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => <div key={d} className="py-2">{d}</div>)}
                        </div>
                        <div className="calendar-grid bg-gray-200">
                            {calendarDays.map((day, idx) => (
                                <div key={idx} className={`calendar-day-cell ${!day.date ? 'bg-gray-50' : isToday(day.date) ? 'bg-blue-50/30' : ''}`}>
                                    {day.date && (
                                        <>
                                            <span className={`text-xs font-bold mb-1 block ${isToday(day.date) ? 'text-wcg-blue' : 'text-gray-400'}`}>
                                                {day.date.getDate()}
                                            </span>
                                            <div className="overflow-y-auto max-h-[80px] hide-scrollbar">
                                                {day.sessions?.map(s => <SessionPill key={s.id} session={s} onClick={setSelectedSession} />)}
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>
                    </main>

                    <SessionModal session={selectedSession} onClose={() => setSelectedSession(null)} />
                    
                    <footer className="py-8 text-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                        Â© 2026 Western Cape Government
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
